# Noverlink Development Docker Compose
#
# For local development: only runs Caddy in Docker, relay runs on host.
#
# Usage:
#   1. Start relay: cd packages/relay && WS_PORT=8444 HTTP_PORT=8080 cargo run
#   2. Start Caddy: cd deploy && docker compose -f docker-compose.dev.yml up
#   3. Access tunnels: https://*.localhost (accept self-signed cert in browser)

services:
  caddy:
    image: caddy:2-alpine
    container_name: noverlink-caddy-dev
    ports:
      - "80:80"     # HTTP
      - "443:443"   # HTTPS
    volumes:
      # Mount dev Caddyfile
      - ./caddy/Caddyfile.dev:/etc/caddy/Caddyfile:ro
      # Persist certificates and config
      - caddy_data_dev:/data
      - caddy_config_dev:/config
    extra_hosts:
      # Allow Caddy to reach host machine (where relay is running)
      - "host.docker.internal:host-gateway"
    restart: unless-stopped

volumes:
  caddy_data_dev:
  caddy_config_dev:
